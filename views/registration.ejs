<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - Chat App</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <!-- Add this wrapper div -->
    <div class="auth-wrapper">
        <div class="auth-card fade-in">
            <!-- Your existing register form code goes here -->
            <div class="auth-logo">
            <i class="bi bi-person-plus-fill"></i>
        </div>
        
        <h2 class="auth-title">Create Account</h2>
        <p class="auth-subtitle">Join our community to start chatting</p>

        <form action="/register" method="post" class="needs-validation" novalidate enctype="multipart/form-data">
            <!-- Full Name -->

            <div class="mb-3 text-center">
            <label class="avatar-upload <%= (error && error.some(e => e.path == 'avatar')) ? 'errors' : '' %> " id="avatarDropZone">
                <input type="file"
                    name="avatar"
                    accept="image/*"
                    hidden
                    id="profileImage">

                <div class="avatar-preview">
                    <img id="avatarPreviewImg" alt="Avatar Preview" style="display:none;">
                    <i class="bi bi-camera-fill"></i>
                    <p class="mb-0">Click to Upload</p>
                    <small class="text-muted">PNG, JPG (max 2MB)</small>
                </div>
            </label>
          </div>


            <div class="input-group <%= (error && error.some(e => e.path == 'fullName')) ? 'errors' : '' %> ">
                <span class="input-group-text"><i class="bi bi-person"></i></span>
                <input type="text" class="form-control" placeholder="Full Name" name="fullName" value="<%= oldInput[0] ? oldInput[0].fullName : '' %>" >
            </div>
            
            <!-- Email -->
             <%  if(error && error.length > 0) {
                     error.forEach((e) => {
                         if(e.msg == 'Email is already taken'){
             %>
             <p class="text-danger mb-1 text-start"><%= e.msg %></p>
             <% }})} %>
            <div class="input-group <%= (error && error.some(e => e.path == 'email')) ? 'errors' : '' %>">
                <span class="input-group-text"><i class="bi bi-envelope"></i></span>
                <input type="email" class="form-control" placeholder="Email Address" name="email" value="<%= oldInput[0] ? oldInput[0].email : '' %>">
            </div>

            <!-- Phone (For OTP simulation) -->
            <div class="input-group <%= (error && error.some(e => e.path == 'contact')) ? 'errors' : '' %> ">
                <span class="input-group-text"><i class="bi bi-telephone"></i></span>
                <input type="tel" class="form-control" placeholder="Phone Number" pattern="[0-9]{10}" title="10 digit mobile number" name="contact" value="<%= oldInput[0] ? oldInput[0].contact : '' %>">
            </div>

            <!-- Password -->
             
            <div class="input-group <%= (error && error.some(e => e.path == 'password')) ? 'errors' : '' %> ">
                <span class="input-group-text"><i class="bi bi-lock"></i></span>
                <input type="password" id="regPassword" class="form-control" placeholder="Password" name="password"  minlength="6" value="<%= oldInput[0] ? oldInput[0].password : '' %>">
                <span class="input-group-text password-toggle" onclick="togglePassword('regPassword')">
                    <i class="bi bi-eye"></i>
                </span>
            </div>

            <!-- Terms Checkbox -->
            <div class="text-start mb-3" style="font-size: 0.85rem;">
                <div class="form-check">
                    <input class="form-check-input <%= (error && error.some(e => e.path == 'agreement')) ? 'errors' : '' %>" type="checkbox" name="agreement" >
                    <label class="form-check-label" style="color: var(--text-secondary);" for="terms">
                        I agree to the <a href="#" style="color: var(--primary-color);">Terms</a> and <a href="#" style="color: var(--primary-color);">Privacy Policy</a>
                    </label>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">
                <span>Sign Up</span>
                <div class="spinner-border spinner-border-sm d-none" role="status"></div>
            </button>
        </form>

        <div class="divider">
            <span>Or sign up with</span>
        </div>

        <!-- Social Buttons -->
        <div class="social-login">
            <button class="btn-social">
                <i class="bi bi-google text-danger"></i> Google
            </button>
            <button class="btn-social">
                <i class="bi bi-apple"></i> Apple
            </button>
        </div>

        <div class="auth-links">
            Already have an account? <a href="/login">Log In</a>
        </div>
            ...
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="../js/togglePassword.js" ></script>

    <script>
        document.getElementById('profileImage').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (!file) return;

            const previewImg = document.getElementById('avatarPreviewImg');
            const previewContainer = document.querySelector('.avatar-preview');

            previewImg.src = URL.createObjectURL(file);
            previewImg.style.display = 'block';

            // Hide icon + text once image is shown
            previewContainer.querySelectorAll('i, p, small').forEach(el => {
                el.style.display = 'none';
            });
        });
    </script>
</body>
</html>